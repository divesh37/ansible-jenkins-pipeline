pipeline{
    agent any
    stages{
        stage('Initiating Pipeline'){
            steps{
                echo 'Starting Pipeline'
            }
        }
        //stage('Build Started'){
                steps { 
                        mail to:"${email}", subject:"Started Build: ${currentBuild.fullDisplayName}", body: " Hi Team, \n Build ${currentBuild.fullDisplayName} started check live status click on this below link:\n ${BUILD_URL}"
                        }
                }//
        stage('Cloning Repository') {
            steps {
                ansiColor('xterm'){
                    ansiblePlaybook(
                        playbook: 'kmt.yml',
                        inventory: 'ansible-config/inventory.inv',
                        credentialsId: 'devops_staging',
                tags: 'clone',
                        colorized: true,
                        extraVars: [
                              project_path: '${p_path}',
                  composefile: '${composefile}',
                              branch: '${select_branch}',
                              repository: '${Repository}'
                        ])
                 }
            }
        }
stage('SonarCloud') {
  environment {
    SCANNER_HOME = tool 'SonarQubeScanner'
    ORGANIZATION = "96ae65a5dcf5c085d3eb5e8eba632cfa107ee154"
    PROJECT_NAME = "kmt-trading"
  }
  steps {
    withSonarQubeEnv('sonarqube_ambab') {
        sh '''$SCANNER_HOME/bin/sonar-scanner -Dsonar.login=$ORGANIZATION \
        -Dsonar.projectKey=$PROJECT_NAME \
        -Dsonar.sources=.'''
    }
  }
}
stage("Quality Gate") {
  steps {
    timeout(time: 1, unit: 'MINUTES') {
        waitForQualityGate abortPipeline: true
    }
  }
}