pipeline{
    agent any
    environment {
        project_path = "/Data/projects/prisma"
    }
    parameters {
        gitParameter branchFilter: 'origin.*/(.*)', defaultValue: 'homepage', name: 'BRANCH_A', type: 'PT_BRANCH', useRepository: '.*devops.git'
        
    }
    stages {
        stage('BranchListing') {
            steps {
                git branch: "${params.BRANCH_A}", url: 'https://gitlab.ambab.com/devops/devops.git'
            }
        }
    }


    stages{
        stage('Initiating Pipeline'){
            steps{
                echo 'Starting Pipeline'
                echo '${p_path}'
                echo '${select_branch}'
            }
        }
        stage('Build') {
            steps{
                echo 'branch name is ${select_branch}'
                sh 'GIT_BRANCH_NAME=`echo ${select_branch} | sed "s/.*origin\\///"`'
                echo '${GIT_BRANCH_NAME}'
            }
        }
        stage('Deploy') {
            steps {
                echo 'deploying...'
                ansiColor('xterm'){
                    ansiblePlaybook(
                        playbook: 'roles.yml',
                        inventory: 'ansible-config/inventory.inv',
                        credentialsId: '226_docker',
                        colorized: true,
                        extraVars: [
                        //    project_path: '/Data/projects/prisma',
                              project_path: '${p_path}',
			                  composefile: '${composefile}',
                              branch: '${select_branch}'
                        //    composeyaml: 'docker-compose.uat.yml',
                        ])
                 }
            }
        }
    }
}
